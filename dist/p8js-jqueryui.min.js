/*!
 * p8js - v0.4.3 -
 * plus8.ch
 * 
 * Copyright (c) 2013, Claudio Romano
 * Licensed Apache-2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Date: 2013-05-15 11:16:29 +0200
 */
(function(e){function t(){e(this).addClass("dirty")}var n={options:{data:null,valueField:"value",prefix:"",title:""},_create:function(){this.element.addClass("p8-inputElem"),this.element.addClass("p8-valueField"),this.element.change(t);var n="";this.options.data[this.options.valueField]!==undefined&&(n=this.options.data[this.options.valueField]);var r=e("<input />").attr("type","text").attr("name",this.options.prefix+"-"+this.options.valueField).attr("title",this.options.title).attr("value",n);this.element.append(r),r.p8AddHint(),r.data("p8-inputElem-value",n),r.data("p8-inputElem-orgValue",n),r.blur(function(){e(this).data("p8-inputElem-value",e(this).attr("value"))})},initRules:function(){this.options.rules!==undefined&&this.element.find("input").rules("add",this.options.rules)}};e.widget("ui.p8ValueField",n);var r={options:{data:null,valueField:"value",prefix:"",title:"",showHint:!1},_create:function(){var n=e("<span>");n.addClass("p8-inputElem"),n.addClass("p8-valueField"),n.change(t);var r=this.element.parent();n.appendTo(r),this.element.appendTo(n),this.element.attr("name",this.options.valueField).attr("title",this.options.title).p8InfoTip(),this.options.showHint&&this.element.p8AddHint(),this.element.data("p8-inputElem-value",e(this).attr("value")),this.element.data("p8-inputElem-orgValue",e(this).attr("value")),this.element.blur(function(){e(this).data("p8-inputElem-value",e(this).attr("value"))}),this.element.focus(function(){e(this).valid()}),this.initRules()},initRules:function(){this.options.rules!==undefined&&this.element.rules("add",this.options.rules)}};e.widget("ui.p8ValueFieldT",r);var i={options:{data:{},typeField:"type",customValueField:"value2",types:null,prefix:"",title:"",cclass:""},_create:function(){this.element.addClass("p8-inputElem"),this.element.addClass("p8-typeSelect");var n=this.options.data[this.options.typeField],r=this.options.data[this.options.typeField];n==="CUSTOM"?(n=this.options.data[this.options.customValueField],r=this.options.data[this.options.customValueField]):n===undefined?n=this.options.types[0]:r=n,n===undefined&&(n="");var i=this.options.types,s=[];e.each(i,function(e,t){s.push(t)});var o=e("<input />").attr("value",n).attr("name",this.options.prefix+"-"+this.options.typeField).addClass(this.options.cclass).autocomplete({source:s,zIndex:99,minLength:0}),u=e("<a/>").button({label:"Open",text:!1,icons:{primary:"ui-icon-circle-triangle-s"}});u.click(function(){o.autocomplete("search",""),o.focus()}),this.element.append(o).append(u),this.element.change(t).bind("autocompletechange",t).bind("autocompleteselect",t).bind("autocompleteselect",function(e,t){o.data("p8-inputElem-value",t.item.value)}),r&&(o.data("p8-inputElem-orgValue",r),o.data("p8-inputElem-value",r)),o.focus(function(){e(this).valid()}).change(function(){e(this).data("p8-inputElem-value",e(this).attr("value"))})},initRules:function(){if(this.options.rules!==undefined){var e=this.element.find("input");e.rules("add",this.options.rules)}}};e.widget("ui.p8TypeSelect",i)})(jQuery),function(e){e.fn.p8uiTwoColPanel=function(t){var n=jQuery.extend({data:null,valueFields:[],prefix:"",innerClass:"form-row-inner"},t);return this.each(function(){var t=e(this),r=null,i=n.valueFields.length,s=0;for(var o=0;o<i;o++){var u=n.valueFields[o];o%2===0&&(s=0,r=e('<div class="'+n.innerClass+" edit p8TwoCol-row-"+o/2+" "+i+'" />'),o===0&&r.addClass("p8TwoCol-row-first"),t.append(e('<div class="'+n.innerClass+'-wrap" />').append(r))),o===i-1&&r!==null&&r.addClass("p8TwoCol-row-last"),u.type==="text"?r.append(e("<span />").addClass("col-"+s).p8ValueField({data:n.data,valueField:u.value,prefix:n.prefix,title:u.title,rules:u.rules})):u.type==="select"&&r.append(e("<span />").addClass("col-"+s).p8TypeSelect({types:u.types,data:n.data,typeField:u.value,customValueField:u.customValueField,prefix:n.prefix,title:u.title,rules:{minlength:2,required:!0,messages:{minlength:"Please, at least {0} characters are necessary"}}})),s++}return e(this)})}}(jQuery),function(e){e.fn.p8uiSimpleSearchPanel=function(t){var n=jQuery.extend({okFunc:null,cancelFunc:null,cancelText:"Cancel",contentTop:null,contentRight:null,fieldName:"search",fieldTitle:"Search"},t);return this.each(function(){var t=e(this);if(n.contentTop!==null){var r=e('<div class="p8-simpleSearchPanel-top" />').append(n.contentTop);t.append(r)}var i=e("<input />").attr("type","text").attr("name",n.fieldName).attr("title",n.fieldTitle);i.keypress(function(t){var r=t.which?t.which:t.keyCode;r===13&&e.isFunction(n.okFunc)&&n.okFunc.call(this)});var s=e('<div class="p8-simpleSearchPanel-field" />');n.contentRight!==null&&s.append(n.contentRight),s.append(i),t.append(s);if(n.buttons!==null){var o=e('<div class="p8-simpleSearchPanel-button" />').append(e("<button />").html(n.cancelText).button().click(function(){}));t.append(o)}})}}(jQuery),function(e){function t(t){var n=[],r;t.typeField!==null&&(r={},r.value=t.typeField,r.customValueField=t.customValueField,r.types=t.types,r.title=e.i18n(t.i180nPackage,t.group),r.i180nPackage=t.i180nPackage,r.type="select",n.push(r));for(var i in t.mapping)r={},r.value=t.mapping[i],r.title=e.i18n(t.i180nPackage,t.group+"-"+i),r.type="text",r.rules=t.rules[i],n.push(r);t.valueFields=n}e.fn.p8uiCreateTypeValueMultiEditor=function(n){var r=jQuery.extend({valueField:"value",i180nPackage:"",mapping:null,typeField:null,customValueField:null,types:null,newCount:0,hiddenNewData:{},rules:{}},n);return r.valueField!==null&&r.mapping===null&&(r.mapping={VALUE_FIELD:r.valueField}),t(r),this.each(function(){return e(this).p8uiMultiEditor(r),e(this)})}}(jQuery),function(e){var t=function(e){return e.attr("id")},n={options:{group:"",title:"",innerSel:".form-row-inner",newCount:0,newFunc:null,allowNew:!0,initFunc:null,hiddenNewData:{},uniqueIdFunc:t},_create:function(){var t=this,n=t.element;this.options.newFunc!==null&&e("<a />").button({text:!1,label:"Add",icons:{primary:"ui-icon-plus"}}).addClass("add").hide().button().click(function(){t.addNew(!0)}).hide().appendTo(n),this.options.title=this.options.group,t.focused=!1},_decorateEditor:function(t){var n=this;t.addClass("form-row");var r=t.find(this.options.innerSel+"-wrap");r.prepend(e("<div><br /></div>").addClass("action-panel"));if(e.isFunction(this.options.newFunc)){if(t.hasClass("init-new"))return;var i=e("<a />").button({text:!1,label:"Delete",icons:{primary:"ui-icon-minus"}}).addClass("delete").click(function(){var r=!1;t.hasClass("new")?r=!0:t.addClass("deleted");var i=n.element.parents(".p8-scroll").data("jsp");if(n.element.find(".form-row").not(":hidden").size()>1){var s=t.height()+2,o=n.element.parents(".jspContainer:first").height(),u=n.element.parents(".jspPane:first"),a=u.height()+u.position().top;a-s<o&&i.scrollByY(s*-1,!0)}return t.animate({height:"toggle",opacity:"toggle"},{duration:600,easing:"easeInBack",complete:function(){r&&(n.element.find(".add").hide().appendTo(n.element),e(this).remove()),n.element.find(".form-row").not(":hidden").size()===0?n.addNew(!0):(n.updateAddButton(),i.reinitialise())}}),!0});t.find(this.options.innerSel+"-wrap:last").find(".action-panel").prepend(i),t.find("input").focus(function(){clearTimeout(n.blurTimer),n.focused||(n.focused=!0,n._trigger("focusgained",null,{item:this}))}),t.find("input").blur(function(){clearTimeout(n.blurTimer),n.focused=!1,n.blurTimer=setTimeout(function(){n.focused!==!0&&n._trigger("focuslost")},50)}),this.element.trigger("focus")}for(var s in this.options.hiddenNewData)r.append(e("<input/>").attr("type","hidden").attr("name",this.options.uniqueIdFunc.call(this,t)+"-"+s).attr("value",this.options.hiddenNewData[s]))},load:function(t){var n=this.options.newFunc;if(e.isFunction(n))for(var r=0,i=t.length;r<i;r++){var s=n.call(this,t[r]);this._decorateEditor(s),this.element.append(s),e(".p8-typeSelect",s).p8TypeSelect("initRules"),e(".p8-valueField",s).p8ValueField("initRules")}t.length===0&&this.addNew(),this.updateAddButton()},addNew:function(t){if(this.options.allowNew===!1)return;var n=this,r=this.options.initFunc,i=this.options.newFunc;if(e.isFunction(r)&&this.element.find(".init-new").length===0)this.addInit(t);else if(e.isFunction(i)){this.element.find(".init-new").hide(200,function(){var t=n.element.find(".add");t.hide(),t.appendTo(n.element),e(this).remove()});var s=i.call(this);this.options.newCount=this.options.newCount+1,s.addClass("new"),this._decorateEditor(s),s.css("opacity",1),this.element.append(s),this.updateAddButton(),e(".p8-typeSelect",s).p8TypeSelect("initRules");if(t){s.css("opacity",0);var o=this.element.parents(".p8-scroll").filter(":first");if(o.length>0){var u=o.data("jsp"),a=s.position().top,f=s.height()+2;u.reinitialise(),a+f>o.height()&&u.scrollByY(f,!0)}}s.hide(),s.css("opacity",1),t===undefined?s.show():s.animate({opacity:"toggle",height:"toggle"},{duration:600,easing:"easeOutBack",complete:function(){n.updateAddButton()}})}},addInit:function(t){var n=this.options.initFunc;if(e.isFunction(n)){var r=n.call(this);this.options.newCount=this.options.newCount+1,r.addClass("init-new"),this._decorateEditor(r),r.css("opacity",1),this.element.append(r),this.updateAddButton();if(t){var i=this.element.parents(".p8-scroll").filter(":first");if(i.length>0){var s=i.data("jsp"),o=r.position().top,u=r.height()+2;s.reinitialise(),o+u>i.height()&&s.scrollByY(u,!0)}}r.hide(),r.css("opacity",1),t===undefined?r.show():r.animate({opacity:"toggle",height:"toggle"},{duration:600,easing:"easeOutBack"})}},updateAddButton:function(){this.element.find(".form-row").removeClass("last").removeClass("first"),this.element.find(".form-row").not(":hidden").length===1?this.element.find(".form-row").not(":hidden").addClass("first").addClass("last"):(this.element.find(".form-row").not(":hidden").first().addClass("first"),this.element.find(".form-row").not(":hidden").last().addClass("last")),this.element.find(this.options.innerSel+"-wrap").removeClass("last").removeClass("first"),this.element.find(this.options.innerSel+"-wrap").not(":hidden").length===1?this.element.find(this.options.innerSel+"-wrap").not(":hidden").addClass("first").addClass("last"):(this.element.find(this.options.innerSel+"-wrap").not(":hidden").first().addClass("first"),this.element.find(this.options.innerSel+"-wrap").not(":hidden").last().addClass("last"));if(this.options.newFunc!==null&&this.element.find(".init-new").length>0){var e=this.element.find(".add");e.css("display","inline-block"),this.element.find(".init-new").find(".action-panel").prepend(e)}}};e.widget("ui.p8uiMultiEditor",n)}(jQuery);